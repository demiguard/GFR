{% extends 'main_page/base.html' %}

{% load static %}
{% load bootstrap4 %}

{% block content %}
  <h2>Udfyld undersøgelse</h2>
  <strong>Undersøgelse rigs nr.:</strong><p>{{ rigsnr }}</p>

  <form method="POST">
    {% csrf_token %}
    
    <!-- Add patient info -->
    {% bootstrap_form study_info_form %}
    {% bootstrap_form study_type_form %}
    
    <!-- Display test info -->
    <h5>Prøve data</h5>
    <div id="test-data-container">
      <!-- Place where JS inserts new test data -->

    </div>

    <!-- Add test info -->
    <strong>Tilføj prøve:</strong>
    <div class="form-row">
      <div class="form-group col-md-3">
        {{ test_context.test_form.test_date.label }}
        {{ test_context.test_form.test_date }}
      </div>
      <div class="form-group col-md-3">
        {{ test_context.test_form.test_time.label }}
        {{ test_context.test_form.test_time }}
      </div>
      <div class="form-group col-md-3">
        {{ test_context.test_form.test_value.label }}
        {{ test_context.test_form.test_value }}
      </div>
    </div>
    {% buttons %}
      <input type="button" value="Tilføj" id="add-test">
    {% endbuttons %}

    <!-- Select test values from csv file -->
    <p>Vælg prøve fra fil:</p>
    <div class="csvAccordion" id="accordionContainer">
      {% for name, data in csv_data %}
        <div class="card">
          <div class="card-header" id="heading-{{ name }}">
            <h2 class="mb-0">
              <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse-{{ name }}" aria-expanded="true" aria-controls="collapse-{{ name }}">
                {{ name }}
              </button>
            </h2>
          </div>

          <div id="collapse-{{ name }}" class="collapse" aria-labelledby="heading-{{ name }}" data-parent="#accordionContainer">
            <div class="card-body">
              <table class="table table-bordered table-hover">
                <thead>
                  <tr>
                    <th>Rack</th>
                    <th>Position</th>
                    <th>Cr-51 Counts</th>
                    <th>Cr-51 CPM</th>
                  </tr>
                </thead>
                <tbody>
                  {% for data_row in data %}
                    <tr class="csv_row">
                      <td>{{ data_row.0 }}</td>
                      <td>{{ data_row.1 }}</td>
                      <td>{{ data_row.2 }}</td>
                      <td>{{ data_row.3 }}</td>
                    </tr>  
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <br>
      {% endfor %}
    </div>

    <!-- Submission buttons -->
    {% buttons %}
      <input type="submit" name="calculate" value="Beregn">
      <input type="submit" name="calculate-nodb" value="Beregn udenom databasen">
      <input type="submit" name="save" value="Gem">
      <input type="button" value="Afbryd" id="cancel">
    {% endbuttons %}
  </form>

  <!-- Inject Bootstrap required JS to allow collapses to close and expand -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

  <script src="{% static 'main_page/js/fill_study.js' %}"></script>
{% endblock %}